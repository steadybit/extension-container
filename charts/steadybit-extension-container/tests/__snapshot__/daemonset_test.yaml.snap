manifest should match snapshot using containerd and using resource limits:
  1: |
    apiVersion: apps/v1
    kind: DaemonSet
    metadata:
      labels:
        steadybit.com/discovery-disabled: "true"
        steadybit.com/extension: "true"
      name: RELEASE-NAME-steadybit-extension-container
      namespace: NAMESPACE
    spec:
      selector:
        matchLabels:
          app: steadybit-extension-container
          app.kubernetes.io/name: steadybit-extension-container
      template:
        metadata:
          annotations:
            container.apparmor.security.beta.kubernetes.io/steadybit-extension-container: unconfined
            steadybit.com/extension-auto-discovery: |
              {"extensions":[{"port":8086,"protocol":"http","types":["ACTION","DISCOVERY"]}]}
          labels:
            app: steadybit-extension-container
            app.kubernetes.io/name: steadybit-extension-container
            steadybit.com/discovery-disabled: "true"
            steadybit.com/extension: "true"
        spec:
          containers:
            - env:
                - name: STEADYBIT_EXTENSION_PORT
                  value: "8086"
                - name: STEADYBIT_EXTENSION_HEALTH_PORT
                  value: "8082"
                - name: STEADYBIT_EXTENSION_RUNC_DEBUG
                  value: "true"
                - name: STEADYBIT_LOG_LEVEL
                  value: INFO
                - name: STEADYBIT_LOG_FORMAT
                  value: text
              image: ghcr.io/steadybit/extension-container:latest
              imagePullPolicy: Always
              livenessProbe:
                failureThreshold: 5
                httpGet:
                  path: /health/liveness
                  port: 8082
                initialDelaySeconds: 10
                periodSeconds: 10
                successThreshold: 1
                timeoutSeconds: 5
              name: steadybit-extension-container
              ports:
                - containerPort: 8086
                  name: http
                - containerPort: 8082
                  name: health
              readinessProbe:
                failureThreshold: 3
                httpGet:
                  path: /health/readiness
                  port: 8082
                initialDelaySeconds: 10
                periodSeconds: 10
                successThreshold: 1
                timeoutSeconds: 1
              resources:
                limits:
                  cpu: 100m
                  memory: 128Mi
                requests:
                  cpu: 200m
                  memory: 256Mi
              securityContext:
                capabilities:
                  add:
                    - SYS_ADMIN
                    - SYS_CHROOT
                    - SYS_RESOURCE
                    - SYS_PTRACE
                    - KILL
                    - NET_ADMIN
                    - DAC_OVERRIDE
                    - SETUID
                    - SETGID
                    - AUDIT_WRITE
                readOnlyRootFilesystem: true
                runAsGroup: 10000
                runAsNonRoot: true
                runAsUser: 10000
                seccompProfile:
                  type: Unconfined
              volumeMounts:
                - mountPath: /tmp
                  name: tmp-dir
                - mountPath: /sys/fs/cgroup
                  name: cgroup-root
                - mountPath: /run/containerd/containerd.sock
                  name: runtime-socket
                - mountPath: /run/containerd/runc/k8s.io
                  name: runtime-runc-root
          dnsPolicy: ClusterFirstWithHostNet
          hostNetwork: true
          hostPID: true
          serviceAccountName: steadybit-extension-container
          volumes:
            - emptyDir: {}
              name: tmp-dir
            - hostPath:
                path: /sys/fs/cgroup
                type: Directory
              name: cgroup-root
            - hostPath:
                path: /run/containerd/containerd.sock
                type: Socket
              name: runtime-socket
            - hostPath:
                path: /run/containerd/runc/k8s.io
                type: Directory
              name: runtime-runc-root
      updateStrategy:
        rollingUpdate:
          maxUnavailable: 1
        type: RollingUpdate
manifest should match snapshot using crio using podAnnotations and Labels:
  1: |
    apiVersion: apps/v1
    kind: DaemonSet
    metadata:
      labels:
        steadybit.com/discovery-disabled: "true"
        steadybit.com/extension: "true"
      name: RELEASE-NAME-steadybit-extension-container
      namespace: NAMESPACE
    spec:
      selector:
        matchLabels:
          app: steadybit-extension-container
          app.kubernetes.io/name: steadybit-extension-container
      template:
        metadata:
          annotations:
            container.apparmor.security.beta.kubernetes.io/steadybit-extension-container: unconfined
            some-annotation: some-annotation-value
            steadybit.com/extension-auto-discovery: |
              {"extensions":[{"port":8086,"protocol":"http","types":["ACTION","DISCOVERY"]}]}
          labels:
            app: steadybit-extension-container
            app.kubernetes.io/name: steadybit-extension-container
            some-label: some-label-value
            steadybit.com/discovery-disabled: "true"
            steadybit.com/extension: "true"
        spec:
          containers:
            - env:
                - name: STEADYBIT_EXTENSION_PORT
                  value: "8086"
                - name: STEADYBIT_EXTENSION_HEALTH_PORT
                  value: "8082"
                - name: STEADYBIT_LOG_LEVEL
                  value: INFO
                - name: STEADYBIT_LOG_FORMAT
                  value: text
              image: ghcr.io/steadybit/extension-container:latest
              imagePullPolicy: Always
              livenessProbe:
                failureThreshold: 5
                httpGet:
                  path: /health/liveness
                  port: 8082
                initialDelaySeconds: 10
                periodSeconds: 10
                successThreshold: 1
                timeoutSeconds: 5
              name: steadybit-extension-container
              ports:
                - containerPort: 8086
                  name: http
                - containerPort: 8082
                  name: health
              readinessProbe:
                failureThreshold: 3
                httpGet:
                  path: /health/readiness
                  port: 8082
                initialDelaySeconds: 10
                periodSeconds: 10
                successThreshold: 1
                timeoutSeconds: 1
              resources:
                limits:
                  cpu: 500m
                  memory: 128Mi
                requests:
                  cpu: 100m
                  memory: 32Mi
              securityContext:
                capabilities:
                  add:
                    - SYS_ADMIN
                    - SYS_CHROOT
                    - SYS_RESOURCE
                    - SYS_PTRACE
                    - KILL
                    - NET_ADMIN
                    - DAC_OVERRIDE
                    - SETUID
                    - SETGID
                    - AUDIT_WRITE
                readOnlyRootFilesystem: true
                runAsGroup: 10000
                runAsNonRoot: true
                runAsUser: 10000
                seccompProfile:
                  type: Unconfined
              volumeMounts:
                - mountPath: /tmp
                  name: tmp-dir
                - mountPath: /sys/fs/cgroup
                  name: cgroup-root
                - mountPath: /var/run/crio/crio.sock
                  name: runtime-socket
                - mountPath: /run/runc
                  name: runtime-runc-root
          dnsPolicy: ClusterFirstWithHostNet
          hostNetwork: true
          hostPID: true
          serviceAccountName: steadybit-extension-container
          volumes:
            - emptyDir: {}
              name: tmp-dir
            - hostPath:
                path: /sys/fs/cgroup
                type: Directory
              name: cgroup-root
            - hostPath:
                path: /var/run/crio/crio.sock
                type: Socket
              name: runtime-socket
            - hostPath:
                path: /run/runc
                type: Directory
              name: runtime-runc-root
      updateStrategy:
        rollingUpdate:
          maxUnavailable: 1
        type: RollingUpdate
manifest should match snapshot using docker:
  1: |
    apiVersion: apps/v1
    kind: DaemonSet
    metadata:
      labels:
        steadybit.com/discovery-disabled: "true"
        steadybit.com/extension: "true"
      name: RELEASE-NAME-steadybit-extension-container
      namespace: NAMESPACE
    spec:
      selector:
        matchLabels:
          app: steadybit-extension-container
          app.kubernetes.io/name: steadybit-extension-container
      template:
        metadata:
          annotations:
            container.apparmor.security.beta.kubernetes.io/steadybit-extension-container: unconfined
            steadybit.com/extension-auto-discovery: |
              {"extensions":[{"port":8086,"protocol":"http","types":["ACTION","DISCOVERY"]}]}
          labels:
            app: steadybit-extension-container
            app.kubernetes.io/name: steadybit-extension-container
            steadybit.com/discovery-disabled: "true"
            steadybit.com/extension: "true"
        spec:
          containers:
            - env:
                - name: STEADYBIT_EXTENSION_PORT
                  value: "8086"
                - name: STEADYBIT_EXTENSION_HEALTH_PORT
                  value: "8082"
                - name: STEADYBIT_LOG_LEVEL
                  value: INFO
                - name: STEADYBIT_LOG_FORMAT
                  value: text
              image: ghcr.io/steadybit/extension-container:latest
              imagePullPolicy: Always
              livenessProbe:
                failureThreshold: 5
                httpGet:
                  path: /health/liveness
                  port: 8082
                initialDelaySeconds: 10
                periodSeconds: 10
                successThreshold: 1
                timeoutSeconds: 5
              name: steadybit-extension-container
              ports:
                - containerPort: 8086
                  name: http
                - containerPort: 8082
                  name: health
              readinessProbe:
                failureThreshold: 3
                httpGet:
                  path: /health/readiness
                  port: 8082
                initialDelaySeconds: 10
                periodSeconds: 10
                successThreshold: 1
                timeoutSeconds: 1
              resources:
                limits:
                  cpu: 500m
                  memory: 128Mi
                requests:
                  cpu: 100m
                  memory: 32Mi
              securityContext:
                capabilities:
                  add:
                    - SYS_ADMIN
                    - SYS_CHROOT
                    - SYS_RESOURCE
                    - SYS_PTRACE
                    - KILL
                    - NET_ADMIN
                    - DAC_OVERRIDE
                    - SETUID
                    - SETGID
                    - AUDIT_WRITE
                readOnlyRootFilesystem: true
                runAsGroup: 10000
                runAsNonRoot: true
                runAsUser: 10000
                seccompProfile:
                  type: Unconfined
              volumeMounts:
                - mountPath: /tmp
                  name: tmp-dir
                - mountPath: /sys/fs/cgroup
                  name: cgroup-root
                - mountPath: /var/run/docker.sock
                  name: runtime-socket
                - mountPath: /run/docker/runtime-runc/moby
                  name: runtime-runc-root
          dnsPolicy: ClusterFirstWithHostNet
          hostNetwork: true
          hostPID: true
          serviceAccountName: steadybit-extension-container
          volumes:
            - emptyDir: {}
              name: tmp-dir
            - hostPath:
                path: /sys/fs/cgroup
                type: Directory
              name: cgroup-root
            - hostPath:
                path: /var/run/docker.sock
                type: Socket
              name: runtime-socket
            - hostPath:
                path: /run/docker/runtime-runc/moby
                type: Directory
              name: runtime-runc-root
      updateStrategy:
        rollingUpdate:
          maxUnavailable: 1
        type: RollingUpdate
manifest should match snapshot with TLS:
  1: |
    apiVersion: apps/v1
    kind: DaemonSet
    metadata:
      labels:
        steadybit.com/discovery-disabled: "true"
        steadybit.com/extension: "true"
      name: RELEASE-NAME-steadybit-extension-container
      namespace: NAMESPACE
    spec:
      selector:
        matchLabels:
          app: steadybit-extension-container
          app.kubernetes.io/name: steadybit-extension-container
      template:
        metadata:
          annotations:
            container.apparmor.security.beta.kubernetes.io/steadybit-extension-container: unconfined
            steadybit.com/extension-auto-discovery: |
              {"extensions":[{"port":8086,"protocol":"https","types":["ACTION","DISCOVERY"]}]}
          labels:
            app: steadybit-extension-container
            app.kubernetes.io/name: steadybit-extension-container
            steadybit.com/discovery-disabled: "true"
            steadybit.com/extension: "true"
        spec:
          containers:
            - env:
                - name: STEADYBIT_EXTENSION_PORT
                  value: "8086"
                - name: STEADYBIT_EXTENSION_HEALTH_PORT
                  value: "8082"
                - name: STEADYBIT_LOG_LEVEL
                  value: INFO
                - name: STEADYBIT_LOG_FORMAT
                  value: text
                - name: STEADYBIT_EXTENSION_TLS_SERVER_CERT
                  value: /etc/extension/certificates/server-cert/tls.crt
                - name: STEADYBIT_EXTENSION_TLS_SERVER_KEY
                  value: /etc/extension/certificates/server-cert/tls.key
              image: ghcr.io/steadybit/extension-container:latest
              imagePullPolicy: Always
              livenessProbe:
                failureThreshold: 5
                httpGet:
                  path: /health/liveness
                  port: 8082
                initialDelaySeconds: 10
                periodSeconds: 10
                successThreshold: 1
                timeoutSeconds: 5
              name: steadybit-extension-container
              ports:
                - containerPort: 8086
                  name: http
                - containerPort: 8082
                  name: health
              readinessProbe:
                failureThreshold: 3
                httpGet:
                  path: /health/readiness
                  port: 8082
                initialDelaySeconds: 10
                periodSeconds: 10
                successThreshold: 1
                timeoutSeconds: 1
              resources:
                limits:
                  cpu: 500m
                  memory: 128Mi
                requests:
                  cpu: 100m
                  memory: 32Mi
              securityContext:
                capabilities:
                  add:
                    - SYS_ADMIN
                    - SYS_CHROOT
                    - SYS_RESOURCE
                    - SYS_PTRACE
                    - KILL
                    - NET_ADMIN
                    - DAC_OVERRIDE
                    - SETUID
                    - SETGID
                    - AUDIT_WRITE
                readOnlyRootFilesystem: true
                runAsGroup: 10000
                runAsNonRoot: true
                runAsUser: 10000
                seccompProfile:
                  type: Unconfined
              volumeMounts:
                - mountPath: /tmp
                  name: tmp-dir
                - mountPath: /sys/fs/cgroup
                  name: cgroup-root
                - mountPath: /var/run/docker.sock
                  name: runtime-socket
                - mountPath: /run/docker/runtime-runc/moby
                  name: runtime-runc-root
                - mountPath: /etc/extension/certificates/server-cert
                  name: certificate-server-cert
                  readOnly: true
          dnsPolicy: ClusterFirstWithHostNet
          hostNetwork: true
          hostPID: true
          serviceAccountName: steadybit-extension-container
          volumes:
            - emptyDir: {}
              name: tmp-dir
            - hostPath:
                path: /sys/fs/cgroup
                type: Directory
              name: cgroup-root
            - hostPath:
                path: /var/run/docker.sock
                type: Socket
              name: runtime-socket
            - hostPath:
                path: /run/docker/runtime-runc/moby
                type: Directory
              name: runtime-runc-root
            - name: certificate-server-cert
              secret:
                optional: false
                secretName: server-cert
      updateStrategy:
        rollingUpdate:
          maxUnavailable: 1
        type: RollingUpdate
manifest should match snapshot with different containerPorts:
  1: |
    apiVersion: apps/v1
    kind: DaemonSet
    metadata:
      labels:
        steadybit.com/discovery-disabled: "true"
        steadybit.com/extension: "true"
      name: RELEASE-NAME-steadybit-extension-container
      namespace: NAMESPACE
    spec:
      selector:
        matchLabels:
          app: steadybit-extension-container
          app.kubernetes.io/name: steadybit-extension-container
      template:
        metadata:
          annotations:
            container.apparmor.security.beta.kubernetes.io/steadybit-extension-container: unconfined
            steadybit.com/extension-auto-discovery: |
              {"extensions":[{"port":9090,"protocol":"http","types":["ACTION","DISCOVERY"]}]}
          labels:
            app: steadybit-extension-container
            app.kubernetes.io/name: steadybit-extension-container
            steadybit.com/discovery-disabled: "true"
            steadybit.com/extension: "true"
        spec:
          containers:
            - env:
                - name: STEADYBIT_EXTENSION_PORT
                  value: "9090"
                - name: STEADYBIT_EXTENSION_HEALTH_PORT
                  value: "9091"
                - name: STEADYBIT_LOG_LEVEL
                  value: INFO
                - name: STEADYBIT_LOG_FORMAT
                  value: text
              image: ghcr.io/steadybit/extension-container:latest
              imagePullPolicy: Always
              livenessProbe:
                failureThreshold: 5
                httpGet:
                  path: /health/liveness
                  port: 9091
                initialDelaySeconds: 10
                periodSeconds: 10
                successThreshold: 1
                timeoutSeconds: 5
              name: steadybit-extension-container
              ports:
                - containerPort: 9090
                  name: http
                - containerPort: 9091
                  name: health
              readinessProbe:
                failureThreshold: 3
                httpGet:
                  path: /health/readiness
                  port: 9091
                initialDelaySeconds: 10
                periodSeconds: 10
                successThreshold: 1
                timeoutSeconds: 1
              resources:
                limits:
                  cpu: 500m
                  memory: 128Mi
                requests:
                  cpu: 100m
                  memory: 32Mi
              securityContext:
                capabilities:
                  add:
                    - SYS_ADMIN
                    - SYS_CHROOT
                    - SYS_RESOURCE
                    - SYS_PTRACE
                    - KILL
                    - NET_ADMIN
                    - DAC_OVERRIDE
                    - SETUID
                    - SETGID
                    - AUDIT_WRITE
                readOnlyRootFilesystem: true
                runAsGroup: 10000
                runAsNonRoot: true
                runAsUser: 10000
                seccompProfile:
                  type: Unconfined
              volumeMounts:
                - mountPath: /tmp
                  name: tmp-dir
                - mountPath: /sys/fs/cgroup
                  name: cgroup-root
                - mountPath: /run/containerd/containerd.sock
                  name: runtime-socket
                - mountPath: /run/containerd/runc/k8s.io
                  name: runtime-runc-root
          dnsPolicy: ClusterFirstWithHostNet
          hostNetwork: true
          hostPID: true
          serviceAccountName: steadybit-extension-container
          volumes:
            - emptyDir: {}
              name: tmp-dir
            - hostPath:
                path: /sys/fs/cgroup
                type: Directory
              name: cgroup-root
            - hostPath:
                path: /run/containerd/containerd.sock
                type: Socket
              name: runtime-socket
            - hostPath:
                path: /run/containerd/runc/k8s.io
                type: Directory
              name: runtime-runc-root
      updateStrategy:
        rollingUpdate:
          maxUnavailable: 1
        type: RollingUpdate
manifest should match snapshot with discover all deployments:
  1: |
    apiVersion: apps/v1
    kind: DaemonSet
    metadata:
      labels:
        steadybit.com/discovery-disabled: "true"
        steadybit.com/extension: "true"
      name: RELEASE-NAME-steadybit-extension-container
      namespace: NAMESPACE
    spec:
      selector:
        matchLabels:
          app: steadybit-extension-container
          app.kubernetes.io/name: steadybit-extension-container
      template:
        metadata:
          annotations:
            container.apparmor.security.beta.kubernetes.io/steadybit-extension-container: unconfined
            steadybit.com/extension-auto-discovery: |
              {"extensions":[{"port":8086,"protocol":"http","types":["ACTION","DISCOVERY"]}]}
          labels:
            app: steadybit-extension-container
            app.kubernetes.io/name: steadybit-extension-container
            steadybit.com/discovery-disabled: "true"
            steadybit.com/extension: "true"
        spec:
          containers:
            - env:
                - name: STEADYBIT_EXTENSION_PORT
                  value: "8086"
                - name: STEADYBIT_EXTENSION_HEALTH_PORT
                  value: "8082"
                - name: STEADYBIT_EXTENSION_DISABLE_DISCOVERY_EXCLUDES
                  value: "true"
                - name: STEADYBIT_LOG_LEVEL
                  value: INFO
                - name: STEADYBIT_LOG_FORMAT
                  value: text
              image: ghcr.io/steadybit/extension-container:latest
              imagePullPolicy: Always
              livenessProbe:
                failureThreshold: 5
                httpGet:
                  path: /health/liveness
                  port: 8082
                initialDelaySeconds: 10
                periodSeconds: 10
                successThreshold: 1
                timeoutSeconds: 5
              name: steadybit-extension-container
              ports:
                - containerPort: 8086
                  name: http
                - containerPort: 8082
                  name: health
              readinessProbe:
                failureThreshold: 3
                httpGet:
                  path: /health/readiness
                  port: 8082
                initialDelaySeconds: 10
                periodSeconds: 10
                successThreshold: 1
                timeoutSeconds: 1
              resources:
                limits:
                  cpu: 500m
                  memory: 128Mi
                requests:
                  cpu: 100m
                  memory: 32Mi
              securityContext:
                capabilities:
                  add:
                    - SYS_ADMIN
                    - SYS_CHROOT
                    - SYS_RESOURCE
                    - SYS_PTRACE
                    - KILL
                    - NET_ADMIN
                    - DAC_OVERRIDE
                    - SETUID
                    - SETGID
                    - AUDIT_WRITE
                readOnlyRootFilesystem: true
                runAsGroup: 10000
                runAsNonRoot: true
                runAsUser: 10000
                seccompProfile:
                  type: Unconfined
              volumeMounts:
                - mountPath: /tmp
                  name: tmp-dir
                - mountPath: /sys/fs/cgroup
                  name: cgroup-root
                - mountPath: /run/containerd/containerd.sock
                  name: runtime-socket
                - mountPath: /run/containerd/runc/k8s.io
                  name: runtime-runc-root
          dnsPolicy: ClusterFirstWithHostNet
          hostNetwork: true
          hostPID: true
          serviceAccountName: steadybit-extension-container
          volumes:
            - emptyDir: {}
              name: tmp-dir
            - hostPath:
                path: /sys/fs/cgroup
                type: Directory
              name: cgroup-root
            - hostPath:
                path: /run/containerd/containerd.sock
                type: Socket
              name: runtime-socket
            - hostPath:
                path: /run/containerd/runc/k8s.io
                type: Directory
              name: runtime-runc-root
      updateStrategy:
        rollingUpdate:
          maxUnavailable: 1
        type: RollingUpdate
manifest should match snapshot with extra env vars:
  1: |
    apiVersion: apps/v1
    kind: DaemonSet
    metadata:
      labels:
        steadybit.com/discovery-disabled: "true"
        steadybit.com/extension: "true"
      name: RELEASE-NAME-steadybit-extension-container
      namespace: NAMESPACE
    spec:
      selector:
        matchLabels:
          app: steadybit-extension-container
          app.kubernetes.io/name: steadybit-extension-container
      template:
        metadata:
          annotations:
            container.apparmor.security.beta.kubernetes.io/steadybit-extension-container: unconfined
            steadybit.com/extension-auto-discovery: |
              {"extensions":[{"port":8086,"protocol":"http","types":["ACTION","DISCOVERY"]}]}
          labels:
            app: steadybit-extension-container
            app.kubernetes.io/name: steadybit-extension-container
            steadybit.com/discovery-disabled: "true"
            steadybit.com/extension: "true"
        spec:
          containers:
            - env:
                - name: STEADYBIT_EXTENSION_PORT
                  value: "8086"
                - name: STEADYBIT_EXTENSION_HEALTH_PORT
                  value: "8082"
                - name: STEADYBIT_LOG_LEVEL
                  value: INFO
                - name: STEADYBIT_LOG_FORMAT
                  value: text
                - name: FOO
                  value: bar
              envFrom:
                - configMapRef: null
                  name: env-configmap
                - name: env-secrets
                  secretRef: null
              image: ghcr.io/steadybit/extension-container:latest
              imagePullPolicy: Always
              livenessProbe:
                failureThreshold: 5
                httpGet:
                  path: /health/liveness
                  port: 8082
                initialDelaySeconds: 10
                periodSeconds: 10
                successThreshold: 1
                timeoutSeconds: 5
              name: steadybit-extension-container
              ports:
                - containerPort: 8086
                  name: http
                - containerPort: 8082
                  name: health
              readinessProbe:
                failureThreshold: 3
                httpGet:
                  path: /health/readiness
                  port: 8082
                initialDelaySeconds: 10
                periodSeconds: 10
                successThreshold: 1
                timeoutSeconds: 1
              resources:
                limits:
                  cpu: 500m
                  memory: 128Mi
                requests:
                  cpu: 100m
                  memory: 32Mi
              securityContext:
                capabilities:
                  add:
                    - SYS_ADMIN
                    - SYS_CHROOT
                    - SYS_RESOURCE
                    - SYS_PTRACE
                    - KILL
                    - NET_ADMIN
                    - DAC_OVERRIDE
                    - SETUID
                    - SETGID
                    - AUDIT_WRITE
                readOnlyRootFilesystem: true
                runAsGroup: 10000
                runAsNonRoot: true
                runAsUser: 10000
                seccompProfile:
                  type: Unconfined
              volumeMounts:
                - mountPath: /tmp
                  name: tmp-dir
                - mountPath: /sys/fs/cgroup
                  name: cgroup-root
                - mountPath: /run/containerd/containerd.sock
                  name: runtime-socket
                - mountPath: /run/containerd/runc/k8s.io
                  name: runtime-runc-root
          dnsPolicy: ClusterFirstWithHostNet
          hostNetwork: true
          hostPID: true
          serviceAccountName: steadybit-extension-container
          volumes:
            - emptyDir: {}
              name: tmp-dir
            - hostPath:
                path: /sys/fs/cgroup
                type: Directory
              name: cgroup-root
            - hostPath:
                path: /run/containerd/containerd.sock
                type: Socket
              name: runtime-socket
            - hostPath:
                path: /run/containerd/runc/k8s.io
                type: Directory
              name: runtime-runc-root
      updateStrategy:
        rollingUpdate:
          maxUnavailable: 1
        type: RollingUpdate
manifest should match snapshot with extra labels:
  1: |
    apiVersion: apps/v1
    kind: DaemonSet
    metadata:
      labels:
        steadybit.com/discovery-disabled: "true"
        steadybit.com/extension: "true"
        tags.datadoghq.com/service: steadybit-extension
      name: RELEASE-NAME-steadybit-extension-container
      namespace: NAMESPACE
    spec:
      selector:
        matchLabels:
          app: steadybit-extension-container
          app.kubernetes.io/name: steadybit-extension-container
      template:
        metadata:
          annotations:
            container.apparmor.security.beta.kubernetes.io/steadybit-extension-container: unconfined
            steadybit.com/extension-auto-discovery: |
              {"extensions":[{"port":8086,"protocol":"http","types":["ACTION","DISCOVERY"]}]}
          labels:
            app: steadybit-extension-container
            app.kubernetes.io/name: steadybit-extension-container
            steadybit.com/discovery-disabled: "true"
            steadybit.com/extension: "true"
            tags.datadoghq.com/service: steadybit-extension
        spec:
          containers:
            - env:
                - name: STEADYBIT_EXTENSION_PORT
                  value: "8086"
                - name: STEADYBIT_EXTENSION_HEALTH_PORT
                  value: "8082"
                - name: STEADYBIT_LOG_LEVEL
                  value: INFO
                - name: STEADYBIT_LOG_FORMAT
                  value: text
              image: ghcr.io/steadybit/extension-container:latest
              imagePullPolicy: Always
              livenessProbe:
                failureThreshold: 5
                httpGet:
                  path: /health/liveness
                  port: 8082
                initialDelaySeconds: 10
                periodSeconds: 10
                successThreshold: 1
                timeoutSeconds: 5
              name: steadybit-extension-container
              ports:
                - containerPort: 8086
                  name: http
                - containerPort: 8082
                  name: health
              readinessProbe:
                failureThreshold: 3
                httpGet:
                  path: /health/readiness
                  port: 8082
                initialDelaySeconds: 10
                periodSeconds: 10
                successThreshold: 1
                timeoutSeconds: 1
              resources:
                limits:
                  cpu: 500m
                  memory: 128Mi
                requests:
                  cpu: 100m
                  memory: 32Mi
              securityContext:
                capabilities:
                  add:
                    - SYS_ADMIN
                    - SYS_CHROOT
                    - SYS_RESOURCE
                    - SYS_PTRACE
                    - KILL
                    - NET_ADMIN
                    - DAC_OVERRIDE
                    - SETUID
                    - SETGID
                    - AUDIT_WRITE
                readOnlyRootFilesystem: true
                runAsGroup: 10000
                runAsNonRoot: true
                runAsUser: 10000
                seccompProfile:
                  type: Unconfined
              volumeMounts:
                - mountPath: /tmp
                  name: tmp-dir
                - mountPath: /sys/fs/cgroup
                  name: cgroup-root
                - mountPath: /run/containerd/containerd.sock
                  name: runtime-socket
                - mountPath: /run/containerd/runc/k8s.io
                  name: runtime-runc-root
          dnsPolicy: ClusterFirstWithHostNet
          hostNetwork: true
          hostPID: true
          serviceAccountName: steadybit-extension-container
          volumes:
            - emptyDir: {}
              name: tmp-dir
            - hostPath:
                path: /sys/fs/cgroup
                type: Directory
              name: cgroup-root
            - hostPath:
                path: /run/containerd/containerd.sock
                type: Socket
              name: runtime-socket
            - hostPath:
                path: /run/containerd/runc/k8s.io
                type: Directory
              name: runtime-runc-root
      updateStrategy:
        rollingUpdate:
          maxUnavailable: 1
        type: RollingUpdate
manifest should match snapshot with mutual TLS:
  1: |
    apiVersion: apps/v1
    kind: DaemonSet
    metadata:
      labels:
        steadybit.com/discovery-disabled: "true"
        steadybit.com/extension: "true"
      name: RELEASE-NAME-steadybit-extension-container
      namespace: NAMESPACE
    spec:
      selector:
        matchLabels:
          app: steadybit-extension-container
          app.kubernetes.io/name: steadybit-extension-container
      template:
        metadata:
          annotations:
            container.apparmor.security.beta.kubernetes.io/steadybit-extension-container: unconfined
            steadybit.com/extension-auto-discovery: |
              {"extensions":[{"port":8086,"protocol":"https","types":["ACTION","DISCOVERY"]}]}
          labels:
            app: steadybit-extension-container
            app.kubernetes.io/name: steadybit-extension-container
            steadybit.com/discovery-disabled: "true"
            steadybit.com/extension: "true"
        spec:
          containers:
            - env:
                - name: STEADYBIT_EXTENSION_PORT
                  value: "8086"
                - name: STEADYBIT_EXTENSION_HEALTH_PORT
                  value: "8082"
                - name: STEADYBIT_LOG_LEVEL
                  value: INFO
                - name: STEADYBIT_LOG_FORMAT
                  value: text
                - name: STEADYBIT_EXTENSION_TLS_SERVER_CERT
                  value: /etc/extension/certificates/server-cert/tls.crt
                - name: STEADYBIT_EXTENSION_TLS_SERVER_KEY
                  value: /etc/extension/certificates/server-cert/tls.key
                - name: STEADYBIT_EXTENSION_TLS_CLIENT_CAS
                  value: /etc/extension/certificates/client-cert-a/tls.crt,/etc/extension/certificates/client-cert-a/tls.crt
              image: ghcr.io/steadybit/extension-container:latest
              imagePullPolicy: Always
              livenessProbe:
                failureThreshold: 5
                httpGet:
                  path: /health/liveness
                  port: 8082
                initialDelaySeconds: 10
                periodSeconds: 10
                successThreshold: 1
                timeoutSeconds: 5
              name: steadybit-extension-container
              ports:
                - containerPort: 8086
                  name: http
                - containerPort: 8082
                  name: health
              readinessProbe:
                failureThreshold: 3
                httpGet:
                  path: /health/readiness
                  port: 8082
                initialDelaySeconds: 10
                periodSeconds: 10
                successThreshold: 1
                timeoutSeconds: 1
              resources:
                limits:
                  cpu: 500m
                  memory: 128Mi
                requests:
                  cpu: 100m
                  memory: 32Mi
              securityContext:
                capabilities:
                  add:
                    - SYS_ADMIN
                    - SYS_CHROOT
                    - SYS_RESOURCE
                    - SYS_PTRACE
                    - KILL
                    - NET_ADMIN
                    - DAC_OVERRIDE
                    - SETUID
                    - SETGID
                    - AUDIT_WRITE
                readOnlyRootFilesystem: true
                runAsGroup: 10000
                runAsNonRoot: true
                runAsUser: 10000
                seccompProfile:
                  type: Unconfined
              volumeMounts:
                - mountPath: /tmp
                  name: tmp-dir
                - mountPath: /sys/fs/cgroup
                  name: cgroup-root
                - mountPath: /var/run/docker.sock
                  name: runtime-socket
                - mountPath: /run/docker/runtime-runc/moby
                  name: runtime-runc-root
                - mountPath: /etc/extension/certificates/client-cert-a
                  name: certificate-client-cert-a
                  readOnly: true
                - mountPath: /etc/extension/certificates/server-cert
                  name: certificate-server-cert
                  readOnly: true
          dnsPolicy: ClusterFirstWithHostNet
          hostNetwork: true
          hostPID: true
          serviceAccountName: steadybit-extension-container
          volumes:
            - emptyDir: {}
              name: tmp-dir
            - hostPath:
                path: /sys/fs/cgroup
                type: Directory
              name: cgroup-root
            - hostPath:
                path: /var/run/docker.sock
                type: Socket
              name: runtime-socket
            - hostPath:
                path: /run/docker/runtime-runc/moby
                type: Directory
              name: runtime-runc-root
            - name: certificate-client-cert-a
              secret:
                optional: false
                secretName: client-cert-a
            - name: certificate-server-cert
              secret:
                optional: false
                secretName: server-cert
      updateStrategy:
        rollingUpdate:
          maxUnavailable: 1
        type: RollingUpdate
manifest should match snapshot with mutual TLS using containerPaths:
  1: |
    apiVersion: apps/v1
    kind: DaemonSet
    metadata:
      labels:
        steadybit.com/discovery-disabled: "true"
        steadybit.com/extension: "true"
      name: RELEASE-NAME-steadybit-extension-container
      namespace: NAMESPACE
    spec:
      selector:
        matchLabels:
          app: steadybit-extension-container
          app.kubernetes.io/name: steadybit-extension-container
      template:
        metadata:
          annotations:
            container.apparmor.security.beta.kubernetes.io/steadybit-extension-container: unconfined
            steadybit.com/extension-auto-discovery: |
              {"extensions":[{"port":8086,"protocol":"https","types":["ACTION","DISCOVERY"]}]}
          labels:
            app: steadybit-extension-container
            app.kubernetes.io/name: steadybit-extension-container
            steadybit.com/discovery-disabled: "true"
            steadybit.com/extension: "true"
        spec:
          containers:
            - env:
                - name: STEADYBIT_EXTENSION_PORT
                  value: "8086"
                - name: STEADYBIT_EXTENSION_HEALTH_PORT
                  value: "8082"
                - name: STEADYBIT_LOG_LEVEL
                  value: INFO
                - name: STEADYBIT_LOG_FORMAT
                  value: text
                - name: STEADYBIT_EXTENSION_TLS_SERVER_CERT
                  value: /etc/tls/server.crt
                - name: STEADYBIT_EXTENSION_TLS_SERVER_KEY
                  value: /etc/tls/server.key
                - name: STEADYBIT_EXTENSION_TLS_CLIENT_CAS
                  value: /etc/tls/ca.crt,/etc/tls/ca2.crt
              image: ghcr.io/steadybit/extension-container:latest
              imagePullPolicy: Always
              livenessProbe:
                failureThreshold: 5
                httpGet:
                  path: /health/liveness
                  port: 8082
                initialDelaySeconds: 10
                periodSeconds: 10
                successThreshold: 1
                timeoutSeconds: 5
              name: steadybit-extension-container
              ports:
                - containerPort: 8086
                  name: http
                - containerPort: 8082
                  name: health
              readinessProbe:
                failureThreshold: 3
                httpGet:
                  path: /health/readiness
                  port: 8082
                initialDelaySeconds: 10
                periodSeconds: 10
                successThreshold: 1
                timeoutSeconds: 1
              resources:
                limits:
                  cpu: 500m
                  memory: 128Mi
                requests:
                  cpu: 100m
                  memory: 32Mi
              securityContext:
                capabilities:
                  add:
                    - SYS_ADMIN
                    - SYS_CHROOT
                    - SYS_RESOURCE
                    - SYS_PTRACE
                    - KILL
                    - NET_ADMIN
                    - DAC_OVERRIDE
                    - SETUID
                    - SETGID
                    - AUDIT_WRITE
                readOnlyRootFilesystem: true
                runAsGroup: 10000
                runAsNonRoot: true
                runAsUser: 10000
                seccompProfile:
                  type: Unconfined
              volumeMounts:
                - mountPath: /tmp
                  name: tmp-dir
                - mountPath: /sys/fs/cgroup
                  name: cgroup-root
                - mountPath: /run/containerd/containerd.sock
                  name: runtime-socket
                - mountPath: /run/containerd/runc/k8s.io
                  name: runtime-runc-root
          dnsPolicy: ClusterFirstWithHostNet
          hostNetwork: true
          hostPID: true
          serviceAccountName: steadybit-extension-container
          volumes:
            - emptyDir: {}
              name: tmp-dir
            - hostPath:
                path: /sys/fs/cgroup
                type: Directory
              name: cgroup-root
            - hostPath:
                path: /run/containerd/containerd.sock
                type: Socket
              name: runtime-socket
            - hostPath:
                path: /run/containerd/runc/k8s.io
                type: Directory
              name: runtime-runc-root
      updateStrategy:
        rollingUpdate:
          maxUnavailable: 1
        type: RollingUpdate
manifest should match snapshot with podSecurityContext:
  1: |
    apiVersion: apps/v1
    kind: DaemonSet
    metadata:
      labels:
        steadybit.com/discovery-disabled: "true"
        steadybit.com/extension: "true"
      name: RELEASE-NAME-steadybit-extension-container
      namespace: NAMESPACE
    spec:
      selector:
        matchLabels:
          app: steadybit-extension-container
          app.kubernetes.io/name: steadybit-extension-container
      template:
        metadata:
          annotations:
            container.apparmor.security.beta.kubernetes.io/steadybit-extension-container: unconfined
            steadybit.com/extension-auto-discovery: |
              {"extensions":[{"port":8086,"protocol":"http","types":["ACTION","DISCOVERY"]}]}
          labels:
            app: steadybit-extension-container
            app.kubernetes.io/name: steadybit-extension-container
            steadybit.com/discovery-disabled: "true"
            steadybit.com/extension: "true"
        spec:
          containers:
            - env:
                - name: STEADYBIT_EXTENSION_PORT
                  value: "8086"
                - name: STEADYBIT_EXTENSION_HEALTH_PORT
                  value: "8082"
                - name: STEADYBIT_LOG_LEVEL
                  value: INFO
                - name: STEADYBIT_LOG_FORMAT
                  value: text
              image: ghcr.io/steadybit/extension-container:latest
              imagePullPolicy: Always
              livenessProbe:
                failureThreshold: 5
                httpGet:
                  path: /health/liveness
                  port: 8082
                initialDelaySeconds: 10
                periodSeconds: 10
                successThreshold: 1
                timeoutSeconds: 5
              name: steadybit-extension-container
              ports:
                - containerPort: 8086
                  name: http
                - containerPort: 8082
                  name: health
              readinessProbe:
                failureThreshold: 3
                httpGet:
                  path: /health/readiness
                  port: 8082
                initialDelaySeconds: 10
                periodSeconds: 10
                successThreshold: 1
                timeoutSeconds: 1
              resources:
                limits:
                  cpu: 500m
                  memory: 128Mi
                requests:
                  cpu: 100m
                  memory: 32Mi
              securityContext:
                capabilities:
                  add:
                    - SYS_ADMIN
                    - SYS_CHROOT
                    - SYS_RESOURCE
                    - SYS_PTRACE
                    - KILL
                    - NET_ADMIN
                    - DAC_OVERRIDE
                    - SETUID
                    - SETGID
                    - AUDIT_WRITE
                readOnlyRootFilesystem: true
                runAsGroup: 10000
                runAsNonRoot: true
                runAsUser: 10000
                seccompProfile:
                  type: Unconfined
              volumeMounts:
                - mountPath: /tmp
                  name: tmp-dir
                - mountPath: /sys/fs/cgroup
                  name: cgroup-root
                - mountPath: /run/containerd/containerd.sock
                  name: runtime-socket
                - mountPath: /run/containerd/runc/k8s.io
                  name: runtime-runc-root
          dnsPolicy: ClusterFirstWithHostNet
          hostNetwork: true
          hostPID: true
          securityContext:
            runAsUser: 2222
          serviceAccountName: steadybit-extension-container
          volumes:
            - emptyDir: {}
              name: tmp-dir
            - hostPath:
                path: /sys/fs/cgroup
                type: Directory
              name: cgroup-root
            - hostPath:
                path: /run/containerd/containerd.sock
                type: Socket
              name: runtime-socket
            - hostPath:
                path: /run/containerd/runc/k8s.io
                type: Directory
              name: runtime-runc-root
      updateStrategy:
        rollingUpdate:
          maxUnavailable: 1
        type: RollingUpdate
manifest should match snapshot with priority class:
  1: |
    apiVersion: apps/v1
    kind: DaemonSet
    metadata:
      labels:
        steadybit.com/discovery-disabled: "true"
        steadybit.com/extension: "true"
      name: RELEASE-NAME-steadybit-extension-container
      namespace: NAMESPACE
    spec:
      selector:
        matchLabels:
          app: steadybit-extension-container
          app.kubernetes.io/name: steadybit-extension-container
      template:
        metadata:
          annotations:
            container.apparmor.security.beta.kubernetes.io/steadybit-extension-container: unconfined
            steadybit.com/extension-auto-discovery: |
              {"extensions":[{"port":8086,"protocol":"http","types":["ACTION","DISCOVERY"]}]}
          labels:
            app: steadybit-extension-container
            app.kubernetes.io/name: steadybit-extension-container
            steadybit.com/discovery-disabled: "true"
            steadybit.com/extension: "true"
        spec:
          containers:
            - env:
                - name: STEADYBIT_EXTENSION_PORT
                  value: "8086"
                - name: STEADYBIT_EXTENSION_HEALTH_PORT
                  value: "8082"
                - name: STEADYBIT_LOG_LEVEL
                  value: INFO
                - name: STEADYBIT_LOG_FORMAT
                  value: text
              image: ghcr.io/steadybit/extension-container:latest
              imagePullPolicy: Always
              livenessProbe:
                failureThreshold: 5
                httpGet:
                  path: /health/liveness
                  port: 8082
                initialDelaySeconds: 10
                periodSeconds: 10
                successThreshold: 1
                timeoutSeconds: 5
              name: steadybit-extension-container
              ports:
                - containerPort: 8086
                  name: http
                - containerPort: 8082
                  name: health
              readinessProbe:
                failureThreshold: 3
                httpGet:
                  path: /health/readiness
                  port: 8082
                initialDelaySeconds: 10
                periodSeconds: 10
                successThreshold: 1
                timeoutSeconds: 1
              resources:
                limits:
                  cpu: 500m
                  memory: 128Mi
                requests:
                  cpu: 100m
                  memory: 32Mi
              securityContext:
                capabilities:
                  add:
                    - SYS_ADMIN
                    - SYS_CHROOT
                    - SYS_RESOURCE
                    - SYS_PTRACE
                    - KILL
                    - NET_ADMIN
                    - DAC_OVERRIDE
                    - SETUID
                    - SETGID
                    - AUDIT_WRITE
                readOnlyRootFilesystem: true
                runAsGroup: 10000
                runAsNonRoot: true
                runAsUser: 10000
                seccompProfile:
                  type: Unconfined
              volumeMounts:
                - mountPath: /tmp
                  name: tmp-dir
                - mountPath: /sys/fs/cgroup
                  name: cgroup-root
                - mountPath: /run/containerd/containerd.sock
                  name: runtime-socket
                - mountPath: /run/containerd/runc/k8s.io
                  name: runtime-runc-root
          dnsPolicy: ClusterFirstWithHostNet
          hostNetwork: true
          hostPID: true
          priorityClassName: my-priority-class
          serviceAccountName: steadybit-extension-container
          volumes:
            - emptyDir: {}
              name: tmp-dir
            - hostPath:
                path: /sys/fs/cgroup
                type: Directory
              name: cgroup-root
            - hostPath:
                path: /run/containerd/containerd.sock
                type: Socket
              name: runtime-socket
            - hostPath:
                path: /run/containerd/runc/k8s.io
                type: Directory
              name: runtime-runc-root
      updateStrategy:
        rollingUpdate:
          maxUnavailable: 1
        type: RollingUpdate
manifest should match snapshot with update strategy:
  1: |
    apiVersion: apps/v1
    kind: DaemonSet
    metadata:
      labels:
        steadybit.com/discovery-disabled: "true"
        steadybit.com/extension: "true"
      name: RELEASE-NAME-steadybit-extension-container
      namespace: NAMESPACE
    spec:
      selector:
        matchLabels:
          app: steadybit-extension-container
          app.kubernetes.io/name: steadybit-extension-container
      template:
        metadata:
          annotations:
            container.apparmor.security.beta.kubernetes.io/steadybit-extension-container: unconfined
            steadybit.com/extension-auto-discovery: |
              {"extensions":[{"port":8086,"protocol":"http","types":["ACTION","DISCOVERY"]}]}
          labels:
            app: steadybit-extension-container
            app.kubernetes.io/name: steadybit-extension-container
            steadybit.com/discovery-disabled: "true"
            steadybit.com/extension: "true"
        spec:
          containers:
            - env:
                - name: STEADYBIT_EXTENSION_PORT
                  value: "8086"
                - name: STEADYBIT_EXTENSION_HEALTH_PORT
                  value: "8082"
                - name: STEADYBIT_LOG_LEVEL
                  value: INFO
                - name: STEADYBIT_LOG_FORMAT
                  value: text
              image: ghcr.io/steadybit/extension-container:latest
              imagePullPolicy: Always
              livenessProbe:
                failureThreshold: 5
                httpGet:
                  path: /health/liveness
                  port: 8082
                initialDelaySeconds: 10
                periodSeconds: 10
                successThreshold: 1
                timeoutSeconds: 5
              name: steadybit-extension-container
              ports:
                - containerPort: 8086
                  name: http
                - containerPort: 8082
                  name: health
              readinessProbe:
                failureThreshold: 3
                httpGet:
                  path: /health/readiness
                  port: 8082
                initialDelaySeconds: 10
                periodSeconds: 10
                successThreshold: 1
                timeoutSeconds: 1
              resources:
                limits:
                  cpu: 500m
                  memory: 128Mi
                requests:
                  cpu: 100m
                  memory: 32Mi
              securityContext:
                capabilities:
                  add:
                    - SYS_ADMIN
                    - SYS_CHROOT
                    - SYS_RESOURCE
                    - SYS_PTRACE
                    - KILL
                    - NET_ADMIN
                    - DAC_OVERRIDE
                    - SETUID
                    - SETGID
                    - AUDIT_WRITE
                readOnlyRootFilesystem: true
                runAsGroup: 10000
                runAsNonRoot: true
                runAsUser: 10000
                seccompProfile:
                  type: Unconfined
              volumeMounts:
                - mountPath: /tmp
                  name: tmp-dir
                - mountPath: /sys/fs/cgroup
                  name: cgroup-root
                - mountPath: /run/containerd/containerd.sock
                  name: runtime-socket
                - mountPath: /run/containerd/runc/k8s.io
                  name: runtime-runc-root
          dnsPolicy: ClusterFirstWithHostNet
          hostNetwork: true
          hostPID: true
          serviceAccountName: steadybit-extension-container
          volumes:
            - emptyDir: {}
              name: tmp-dir
            - hostPath:
                path: /sys/fs/cgroup
                type: Directory
              name: cgroup-root
            - hostPath:
                path: /run/containerd/containerd.sock
                type: Socket
              name: runtime-socket
            - hostPath:
                path: /run/containerd/runc/k8s.io
                type: Directory
              name: runtime-runc-root
      updateStrategy:
        rollingUpdate:
          maxUnavailable: 5
        type: RollingUpdate
